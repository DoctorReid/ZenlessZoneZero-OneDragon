template_name: "特殊情况-紧急切人"
handlers:
  # 特殊处理
  - states: "![自定义-血量扣减,0,1] & ![自定义-动作不打断,-10,0] & !([按键-切换角色-下一个,0,1]|[按键-切换角色-上一个,0,1])" #没有比掉血更特殊的
    sub_handlers:
      #开局紧急补BUFF
      - states: "![前台-露西] & [露西-特殊技可用] & ![自定义-露西-加油,0,30]"
        operations:
          - op_name: "按键-切换角色"
            agent_name: "露西"
          - operation_template: "露西-高飞球合轴"

      - states: "![前台-苍角] & [苍角-特殊技可用] & ![自定义-苍角-展旗,0,30]"
        operations:
          - op_name: "按键-切换角色"
            agent_name: "苍角"
          - operation_template: "苍角-展旗"

      - states: "![前台-丽娜] & [丽娜-能量]{60, 120} & [自定义-丽娜-人偶,0,20]"
        operations:
          - op_name: "设置状态"
            state: "自定义-丽娜-人偶"
            seconds: 14
          - op_name: "按键-切换角色"
            agent_name: "丽娜"
          - op_name: "按键-特殊攻击"
            post_delay: 0.1
            repeat: 4
          - operation_template: "通用-切人普通攻击"

      - states: "![前台-凯撒] & [凯撒-特殊技可用] & ([自定义-血量扣减,0,3] | ![自定义-凯撒-护盾,0,30])"
        operations:
          - op_name: "按键-切换角色"
            agent_name: "凯撒"
          - op_name: "清除状态"
            state_list: ["自定义-血量扣减"]

      # 星见雅 有6豆就切过去
      - states: "[雅-落霜]{6, 6} & ![前台-雅]"
        operations:
          - op_name: "按键-切换角色"
            agent_name: "雅"

      #队伍里有青衣，切过去打击破
      - states: "[青衣-能量]{0, 120} & ![按键可用-连携技,0,12] & ![自定义-黄光切人, 0, 2.5] & ![前台-青衣]"
        operations:
          - op_name: "按键-切换角色"
            agent_name: "青衣"

      #青衣在失衡其间不小心切出来了就切到输出去
      - states: "[前台-青衣] & [自定义-连携换人,0,12] "
        sub_handlers:
          - states: "[后台-2-强攻] | [后台-2-异常]"
            operations:
              - op_name: "按键-切换角色-上一个"

          - states: "[后台-1-强攻] | [后台-1-异常]"
            operations:
              - op_name: "按键-切换角色-下一个"

          #妮可失衡期间切到妮可
          - states: "([妮可-特殊技可用] | [妮可-终结技可用])  & ![自定义-妮可-能量场,-5,3.5] & [自定义-连携换人,0,8] & ![前台-妮可]"
            operations:
              - op_name: "按键-切换角色"
                agent_name: "妮可"

      #双异常打紊乱
      - states: "[前台-异常] & !([按键-切换角色-下一个,0,0.4]|[按键-切换角色-上一个,0,0.4])"
        sub_handlers:
          #防止打了太多的异常效果
          - states: "[后台-1-异常] | [后台-2-异常]"
            sub_handlers:
              #如果打出了超过1.5管异常条，就切另外一个异常
              - states: "[自定义-异常-冰,0,999]{450, 999} | [自定义-异常-物理,0,999]{450, 999} | [自定义-异常-烈霜,0,999]{450, 999} | [自定义-异常-火,0,999]{450, 999} | [自定义-异常-电,0,999]{450, 999}"
                sub_handlers:
                  - states: "[后台-2-异常]"
                    operations:
                      - op_name: "设置状态"
                        data: ["自定义-速切结束"]
                  #     - op_name: "清除状态"
                  #       state_list:
                  #         [
                  #           "自定义-异常-火",
                  #           "自定义-异常-冰",
                  #           "自定义-异常-烈霜",
                  #           "自定义-异常-电",
                  #           "自定义-异常-物理",
                  #         ]
                  #     - op_name: "按键-切换角色-上一个"
                  # - states: "[后台-1-异常]"
                  #   operations:
                  #     - op_name: "清除状态"
                  #       state_list:
                  #         [
                  #           "自定义-异常-火",
                  #           "自定义-异常-冰",
                  #           "自定义-异常-烈霜",
                  #           "自定义-异常-电",
                  #           "自定义-异常-物理",
                  #         ]
                  #     - op_name: "按键-切换角色-下一个"

      - states: "[前台-击破] & ![自定义-速切结束,0,30] & [自定义-连携换人,0,12]"
        sub_handlers:
          - states: "[后台-1-强攻] | [后台-2-强攻] | [后台-1-异常] | [后台-2-异常]"
            operations:
              - op_name: "按键-特殊攻击"
                post_delay: 0.2
                repeat: 1
              - op_name: "设置状态"
                data: ["自定义-速切结束"]
              - op_name: "按键-特殊攻击"
                post_delay: 0.2
                repeat: 1

      #开局补个BUFF
